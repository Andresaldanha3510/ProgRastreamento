{% extends "base.html" %} {% block title %}Cadastrar Frota - TrackGo{% endblock
%} {% block styles %} {{ super() }}
<style>
  /* Estilos padronizados, baseados no 'cadastrar_cliente.html' */
  .form-container {
    background-color: #e9ecef; /* Cor de fundo do cliente */
    padding: 2rem;
    border-radius: 0.5rem; /* Raio da borda do cliente */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    margin: 0;
  }

  .form-container h1 {
    text-align: center;
  }

  .form-section {
    background: white;
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 1.5rem;
    border-left: 4px solid #2e7d32;
  }

  .section-title {
    font-size: 1.1rem; /* Tamanho da fonte do cliente */
    font-weight: 600;
    color: #2e7d32; /* Cor do título do cliente */
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .form-input,
  .form-select,
  .form-textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .form-input:focus,
  .form-select:focus,
  .form-textarea:focus {
    outline: none;
    border-color: #2e7d32;
    box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
  }

  .btn {
    padding: 0.75rem 1.5rem;
    border-radius: 0.375rem;
    text-decoration: none;
    color: white;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: none;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s;
  }

  .btn-submit {
    background-color: #2563eb;
  }
  .btn-submit:hover {
    background-color: #1d4ed8;
  }

  .btn-back {
    background-color: #6b7280;
  }
  .btn-back:hover {
    background-color: #4b5563;
  }

  .btn-secondary {
    background-color: #4b5563;
  }
  .btn-secondary:hover {
    background-color: #374151;
  }

  .required-field::after {
    content: " *";
    color: #dc2626;
  }

  .radio-group label {
    display: inline-block;
    background-color: #e5e7eb;
    padding: 0.75rem 1.5rem;
    font-family: sans-serif, Arial;
    font-size: 1rem;
    font-weight: 600;
    border: 2px solid #d1d5db;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
  }

  .radio-group input[type="radio"] {
    display: none;
  }

  .radio-group input[type="radio"]:checked + label {
    background-color: #2e7d32;
    color: white;
    border-color: #1b5e20;
    box-shadow: 0 4px 8px rgba(46, 125, 50, 0.2);
  }
</style>
{% endblock %} {% block content %}
<div class="form-container" x-data="anexosManager()">
  <h1 class="text-3xl font-bold mb-6 text-gray-800">
    Central de Cadastro de Frota
  </h1>

  <form
    action="{{ url_for('cadastrar_veiculo') }}"
    method="POST"
    enctype="multipart/form-data"
    id="fleetForm"
  >
    <div class="form-section">
      <h2 class="section-title">
        <i class="fas fa-question-circle text-gray-700"></i>
        <span class="required-field">O que você deseja cadastrar?</span>
      </h2>
      <div class="radio-group flex gap-4">
        <input
          type="radio"
          id="tipo_veiculo"
          name="tipo_cadastro"
          value="veiculo"
          checked
        />
        <label for="tipo_veiculo"
          ><i class="fas fa-truck-moving mr-2"></i>Veículo (Cavalo)</label
        >

        <input
          type="radio"
          id="tipo_carreta"
          name="tipo_cadastro"
          value="carreta"
        />
        <label for="tipo_carreta"
          ><i class="fas fa-trailer mr-2"></i>Carreta (Implemento)</label
        >
      </div>
    </div>

    <div class="form-section">
      <h2 class="section-title">
        <i class="fas fa-id-card text-gray-700"></i>Informações Essenciais
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div>
          <label
            for="placa"
            class="block text-gray-700 font-medium mb-2 required-field"
            >Placa</label
          >
          <input
            type="text"
            name="placa"
            id="placa"
            required
            class="form-input"
            pattern="[A-Z]{3}[0-9][A-Z0-9][0-9]{2}"
            placeholder="ABC1D23"
            maxlength="7"
          />
        </div>
        <div>
          <label
            for="marca"
            class="block text-gray-700 font-medium mb-2 required-field"
            >Marca</label
          >
          <input
            type="text"
            name="marca"
            id="marca"
            required
            class="form-input"
            placeholder="Ex: Scania / Randon"
          />
        </div>
        <div>
          <label
            for="modelo"
            class="block text-gray-700 font-medium mb-2 required-field"
            >Modelo</label
          >
          <input
            type="text"
            name="modelo"
            id="modelo"
            required
            class="form-input"
            placeholder="Ex: R450 / Graneleira"
          />
        </div>
        <div>
          <label for="ano_modelo" class="block text-gray-700 font-medium mb-2"
            >Ano/Modelo</label
          >
          <div class="grid grid-cols-2 gap-2">
            <select
              name="ano_fabricacao"
              id="ano_fabricacao"
              class="form-select"
            >
              <option value="">Ano Fab.</option>
            </select>
            <select name="ano_modelo" id="ano_modelo" class="form-select">
              <option value="">Ano Mod.</option>
            </select>
          </div>
        </div>
        <div>
          <label for="renavam" class="block text-gray-700 font-medium mb-2"
            >RENAVAM</label
          >
          <input
            type="text"
            name="renavam"
            id="renavam"
            class="form-input"
            placeholder="11 dígitos"
            maxlength="11"
          />
        </div>
      </div>
    </div>

    <div id="campos-veiculo">
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-truck text-gray-700"></i>Detalhes do Veículo
          (Opcional)
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div>
            <label for="categoria" class="block text-gray-700 font-medium mb-2"
              >Categoria do Veículo</label
            >
            <select name="categoria" id="categoria" class="form-select">
              <option value="">Selecione a categoria</option>
              <option value="Caminhão">Caminhão</option>
              <option value="Van">Van</option>
              <option value="Utilitário">Utilitário</option>
            </select>
          </div>
          <div>
            <label for="status" class="block text-gray-700 font-medium mb-2"
              >Status</label
            >
            <select name="status" id="status" class="form-select">
              <option value="Disponível">Disponível</option>
              <option value="Em Rota">Em Rota</option>
              <option value="Em Manutenção">Em Manutenção</option>
              <option value="Inativo">Inativo</option>
            </select>
          </div>
          <div>
            <label for="cor" class="block text-gray-700 font-medium mb-2"
              >Cor</label
            >
            <input
              type="text"
              name="cor"
              id="cor"
              class="form-input"
              placeholder="Ex: Branco"
            />
          </div>
          <div>
            <label
              for="combustivel"
              class="block text-gray-700 font-medium mb-2"
              >Combustível</label
            >
            <select name="combustivel" id="combustivel" class="form-select">
              <option value="Diesel">Diesel</option>
              <option value="Gasolina">Gasolina</option>
              <option value="Elétrico">Elétrico</option>
            </select>
          </div>
          <div>
            <label for="km_atual" class="block text-gray-700 font-medium mb-2"
              >Km Atual</label
            >
            <input
              type="number"
              name="km_atual"
              id="km_atual"
              class="form-input"
              placeholder="Ex: 150000"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-file-alt text-gray-700"></i>Documentação (Opcional)
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div>
            <label for="chassi" class="block text-gray-700 font-medium mb-2"
              >Chassi</label
            >
            <input
              type="text"
              name="chassi"
              id="chassi"
              class="form-input"
              placeholder="17 caracteres"
              maxlength="17"
            />
          </div>
          <div>
            <label
              for="numero_motor"
              class="block text-gray-700 font-medium mb-2"
              >Número do Motor</label
            >
            <input
              type="text"
              name="numero_motor"
              id="numero_motor"
              class="form-input"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-cogs text-gray-700"></i>Especificações Técnicas
          (Opcional)
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div>
            <label for="potencia" class="block text-gray-700 font-medium mb-2"
              >Potência (cv)</label
            >
            <input
              type="number"
              name="potencia"
              id="potencia"
              class="form-input"
            />
          </div>
          <div>
            <label
              for="tanque_combustivel"
              class="block text-gray-700 font-medium mb-2"
              >Tanque Comb. (L)</label
            >
            <input
              type="number"
              name="tanque_combustivel"
              id="tanque_combustivel"
              class="form-input"
            />
          </div>
          <div>
            <label
              for="consumo_medio"
              class="block text-gray-700 font-medium mb-2"
              >Consumo Médio (km/L)</label
            >
            <input
              type="number"
              name="consumo_medio"
              id="consumo_medio"
              class="form-input"
              step="0.1"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-road text-gray-700"></i>Informações Operacionais
          (Opcional)
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div>
            <label
              for="valor_aquisicao"
              class="block text-gray-700 font-medium mb-2"
              >Valor de Aquisição</label
            >
            <input
              type="text"
              name="valor_aquisicao"
              id="valor_aquisicao"
              class="form-input"
              placeholder="R$ 0,00"
            />
          </div>
          <div>
            <label
              for="data_aquisicao"
              class="block text-gray-700 font-medium mb-2"
              >Data de Aquisição</label
            >
            <input
              type="date"
              name="data_aquisicao"
              id="data_aquisicao"
              class="form-input"
            />
          </div>
        </div>
      </div>
    </div>

    <div id="campos-carreta" style="display: none">
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-trailer text-gray-700"></i>Especificações da Carreta
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div>
            <label
              for="eixos"
              class="block text-gray-700 font-medium mb-2 required-field"
              >Nº de Eixos</label
            >
            <input
              type="number"
              name="eixos"
              id="eixos"
              class="form-input"
              min="1"
              max="9"
              required
            />
          </div>
          <div>
            <label
              for="capacidade_carga"
              class="block text-gray-700 font-medium mb-2"
              >Capacidade de Carga (kg)</label
            >
            <input
              type="number"
              name="capacidade_carga_carreta"
              class="form-input"
              step="0.01"
            />
          </div>
          <div>
            <label for="peso_bruto" class="block text-gray-700 font-medium mb-2"
              >Peso Bruto Total (kg)</label
            >
            <input
              type="number"
              name="peso_bruto_carreta"
              class="form-input"
              step="0.01"
            />
          </div>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h2 class="section-title">
        <i class="fas fa-paperclip text-gray-700"></i>Observações e Anexos
        (Opcional)
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
        <div class="md:col-span-2">
          <label for="observacoes" class="block text-gray-700 font-medium mb-2"
            >Observações</label
          >
          <textarea
            name="observacoes"
            id="observacoes"
            class="form-textarea"
            rows="3"
            placeholder="Informações adicionais, detalhes sobre o veículo/carreta..."
          ></textarea>
        </div>
        <div class="md:col-span-2">
          <label class="block text-gray-700 font-medium mb-2"
            >Anexos (Fotos, Documentos)</label
          >
          <button
            type="button"
            @click="isAnexosModalOpen = true"
            class="btn btn-secondary w-full sm:w-auto"
          >
            <i class="fas fa-paperclip mr-2"></i>
            Anexar Documentos (<span x-text="files.length">0</span>)
          </button>
        </div>
      </div>
    </div>

    <div class="mt-8 flex justify-end gap-4">
      <a href="{{ url_for('consultar_veiculos') }}" class="btn btn-back"
        >Voltar</a
      >
      <button type="submit" class="btn btn-submit">
        <i class="fas fa-save mr-2"></i> Salvar Cadastro
      </button>
    </div>

    <div
      x-show="isAnexosModalOpen"
      x-transition:enter="ease-out duration-300"
      enter-start-class="opacity-0"
      enter-end-class="opacity-100"
      x-transition:leave="ease-in duration-200"
      leave-start-class="opacity-100"
      leave-end-class="opacity-0"
      class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50"
      style="display: none"
    >
      <div
        @click.away="isAnexosModalOpen = false"
        class="bg-white rounded-lg shadow-xl w-full max-w-2xl"
      >
        <header class="flex justify-between items-center p-4 border-b">
          <h2 class="text-xl font-bold text-gray-800">Anexar Documentos</h2>
          <button
            type="button"
            @click="isAnexosModalOpen = false"
            class="text-gray-400 hover:text-gray-700 text-3xl"
          >
            &times;
          </button>
        </header>

        <div class="p-6 max-h-[60vh] overflow-y-auto">
          <label
            for="anexos-input"
            class="btn bg-blue-600 hover:bg-blue-700 w-full cursor-pointer"
          >
            <i class="fas fa-plus mr-2"></i> Adicionar um ou vários arquivos
          </label>
          <input
            type="file"
            name="anexos"
            id="anexos-input"
            @change="addFiles($event)"
            multiple
            class="hidden"
            accept=".pdf,.jpg,.jpeg,.png"
          />

          <p class="text-sm text-gray-500 mt-4 mb-2">
            Arquivos selecionados para envio:
          </p>
          <ul class="space-y-2">
            <template x-if="files.length === 0">
              <li class="text-center text-gray-500 py-4">
                Nenhum arquivo selecionado.
              </li>
            </template>
            <template x-for="(file, index) in files" :key="index">
              <li
                class="flex justify-between items-center bg-gray-50 p-2 rounded-md border"
              >
                <span
                  class="text-gray-700 truncate pr-2"
                  x-text="file.name"
                ></span>
                <button
                  type="button"
                  @click="removeFile(index)"
                  class="text-red-500 hover:text-red-700"
                  title="Remover Anexo"
                >
                  <i class="fas fa-times-circle"></i>
                </button>
              </li>
            </template>
          </ul>
        </div>

        <footer class="p-4 bg-gray-50 border-t text-right">
          <button
            type="button"
            @click="isAnexosModalOpen = false"
            class="btn bg-gray-500 hover:bg-gray-600"
          >
            Fechar
          </button>
        </footer>
      </div>
    </div>
  </form>
</div>
{% endblock %} {% block scripts %} {{ super() }}
<script>
  // LÓGICA DO MODAL DE ANEXOS (NOVA)
  function anexosManager() {
    return {
      isAnexosModalOpen: false,
      files: [],
      addFiles(event) {
        const newFiles = Array.from(event.target.files);
        this.files.push(...newFiles);
        this.updateFileInput();
      },
      removeFile(index) {
        this.files.splice(index, 1);
        this.updateFileInput();
      },
      updateFileInput() {
        // Sincroniza os arquivos gerenciados pelo AlpineJS com o <input type="file"> real
        const dataTransfer = new DataTransfer();
        this.files.forEach((file) => dataTransfer.items.add(file));
        document.getElementById("anexos-input").files = dataTransfer.files;
      },
    };
  }

  document.addEventListener("DOMContentLoaded", function () {
    // LÓGICA EXISTENTE DO FORMULÁRIO (MANTIDA)

    // Lógica para alternar campos entre Veículo e Carreta
    const tipoVeiculoRadio = document.getElementById("tipo_veiculo");
    const tipoCarretaRadio = document.getElementById("tipo_carreta");
    const camposVeiculoDiv = document.getElementById("campos-veiculo");
    const camposCarretaDiv = document.getElementById("campos-carreta");
    const veiculoRequiredInputs =
      camposVeiculoDiv.querySelectorAll("[required]");
    const carretaRequiredInputs =
      camposCarretaDiv.querySelectorAll("[required]");

    function toggleCampos() {
      const isCarreta = tipoCarretaRadio.checked;
      camposVeiculoDiv.style.display = isCarreta ? "none" : "block";
      camposCarretaDiv.style.display = isCarreta ? "block" : "none";
      veiculoRequiredInputs.forEach((input) => (input.required = !isCarreta));
      carretaRequiredInputs.forEach((input) => (input.required = isCarreta));
    }

    tipoVeiculoRadio.addEventListener("change", toggleCampos);
    tipoCarretaRadio.addEventListener("change", toggleCampos);
    toggleCampos();

    // Lógica para preencher os anos
    const selectAnoFab = document.getElementById("ano_fabricacao");
    const selectAnoMod = document.getElementById("ano_modelo");
    if (selectAnoFab && selectAnoMod) {
      const anoAtual = new Date().getFullYear();
      for (let ano = anoAtual; ano >= 1980; ano--) {
        selectAnoFab.appendChild(new Option(ano, ano));
        selectAnoMod.appendChild(new Option(ano + 1, ano + 1)); // Adiciona próximo ano no modelo
      }
      selectAnoMod.appendChild(new Option(1980, 1980)); // Garante que 1980 esteja no modelo
      selectAnoFab.addEventListener("change", function () {
        if (this.value) {
          selectAnoMod.value = parseInt(this.value);
        }
      });
    }

    // Lógica para formatar valor de aquisição
    const inputValor = document.getElementById("valor_aquisicao");
    if (inputValor) {
      inputValor.addEventListener("input", function (e) {
        let value = e.target.value.replace(/\D/g, "");
        if (value) {
          e.target.value = (Number(value) / 100).toLocaleString("pt-BR", {
            style: "currency",
            currency: "BRL",
          });
        } else {
          e.target.value = "";
        }
      });
    }

    // Lógica para permitir apenas números em certos campos
    ["renavam"].forEach((id) => {
      const element = document.getElementById(id);
      if (element) {
        element.addEventListener("input", function (e) {
          e.target.value = e.target.value.replace(/\D/g, "");
        });
      }
    });
  });
</script>
{% endblock %}
