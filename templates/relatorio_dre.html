{% extends "base.html" %}

{% block title %}Relatório Financeiro (DRE) - TrackGo{% endblock %}

{% block content %}
<div class="p-4 md:p-6 bg-gray-100 min-h-screen">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4">Relatório Financeiro (DRE)</h1>

    <div class="bg-white p-4 rounded-xl shadow-md mb-6">
        <form action="{{ url_for('relatorio_financeiro_dre') }}" method="GET">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="data_inicio" class="block text-sm font-medium text-gray-700">Data Início</label>
                    <input type="date" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" id="data_inicio" name="data_inicio" value="{{ request.args.get('data_inicio', '') }}">
                </div>
                <div>
                    <label for="data_fim" class="block text-sm font-medium text-gray-700">Data Fim</label>
                    <input type="date" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" id="data_fim" name="data_fim" value="{{ request.args.get('data_fim', '') }}">
                </div>
                <div class="flex items-end">
                    <button type="submit" class="w-full bg-green-700 hover:bg-green-800 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors"><i class="fas fa-filter"></i>Aplicar Filtro</button>
                </div>
            </div>
        </form>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-md">
        <div class="space-y-4 text-gray-700">
            <div class="flex justify-between items-center py-2 border-b">
                <span class="font-semibold text-lg">(=) Receita Bruta de Fretes</span>
                <span class="font-bold text-lg text-blue-600">R$ {{ "%.2f"|format(dre.receita_bruta)|replace('.', ',') }}</span>
            </div>
            <div class="flex justify-between items-center py-2 border-b">
                <span class="font-semibold text-lg">(-) Custos Variáveis</span>
                <span class="font-bold text-lg text-red-600">R$ {{ "%.2f"|format(dre.custos_variaveis.Total)|replace('.', ',') }}</span>
            </div>
            <div class="pl-6 space-y-1 text-sm text-gray-500">
                {% for nome, valor in dre.custos_variaveis.items() %}
                    {% if nome != 'Total' and valor > 0 %}
                    <div class="flex justify-between">
                        <span>{{ nome }}</span>
                        <span>R$ {{ "%.2f"|format(valor)|replace('.', ',') }}</span>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
            <div class="flex justify-between items-center py-2 border-b bg-gray-50 -mx-6 px-6">
                <span class="font-semibold text-xl">(=) Margem de Contribuição</span>
                <span class="font-bold text-xl {% if dre.margem_contribuicao >= 0 %}text-green-700{% else %}text-red-700{% endif %}">R$ {{ "%.2f"|format(dre.margem_contribuicao)|replace('.', ',') }}</span>
            </div>
             <div class="flex justify-between items-center py-2 border-b">
                <span class="font-semibold text-lg">(-) Custos Fixos e Operacionais</span>
                <span class="font-bold text-lg text-red-600">R$ {{ "%.2f"|format(dre.custos_fixos.Total)|replace('.', ',') }}</span>
            </div>
            <div class="pl-6 space-y-1 text-sm text-gray-500">
                 {% for nome, valor in dre.custos_fixos.Detalhado.items() %}
                    {% if valor > 0 %}
                    <div class="flex justify-between">
                        <span>{{ nome }}</span>
                        <span>R$ {{ "%.2f"|format(valor)|replace('.', ',') }}</span>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
            <div class="flex justify-between items-center py-3 border-t-2 mt-4 bg-gray-100 -mx-6 px-6">
                <span class="font-semibold text-2xl">(=) Lucro / Prejuízo Operacional</span>
                <span class="font-bold text-2xl {% if dre.lucro_operacional >= 0 %}text-green-800{% else %}text-red-800{% endif %}">R$ {{ "%.2f"|format(dre.lucro_operacional)|replace('.', ',') }}</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}